
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}


enum Status {
  Active
  Inactive
}



model Verification {
  id               Int      @id @default(autoincrement())
  userId           Int
  user             User     @relation("verificationc1",fields: [userId], references: [id], onDelete: Cascade) 
  verificationType String   // 'email' or 'phone'
  verificationCode String   @db.VarChar(6)   // OTP code
  expiresAt        DateTime // OTP expiration timestamp
  createdAt        DateTime @default(now()) @db.Timestamp(0)

  @@index([userId])
}

model RoleModules {
  roleId      Int
  moduleId    Int
  view        Boolean   @default(false)
  add         Boolean   @default(false)
  edit        Boolean   @default(false)
  delete      Boolean   @default(false)

  module      Module    @relation(fields: [moduleId], references: [id])
  userRoles        UserRole  @relation(fields: [roleId], references: [id], name:"UserRoleRelation", map: "UserRole_role_fkey")
  
  @@id([roleId, moduleId]) // Composite primary key
}

model UserRole {
  id          Int       @id @default(autoincrement())
  roleName    String    @unique @db.VarChar(255)
  description String?   @db.Text
  modules     RoleModules[]   @relation("UserRoleRelation", map: "UserRole_role_fkey")
  createdAt   DateTime  @default(now()) @db.Timestamp(0)
  updatedAt   DateTime  @default(now()) @updatedAt @db.Timestamp(0)

  user_roles     User[]     @relation("user_roles")
}

model Module {
  id          Int        @id @default(autoincrement())
  moduleName  String     @unique @db.VarChar(255)
  status      Status     @default(Active)
  allPerimission  Boolean   @default(false)
  roles       RoleModules[]
  createdAt   DateTime   @default(now()) @db.Timestamp(0)
  updatedAt   DateTime   @default(now()) @updatedAt @db.Timestamp(0)
}

model User {
  id                 Int                  @id @default(autoincrement())
  firstName          String               @db.VarChar(225)
  lastName           String               @db.VarChar(225)
  email                 String?         @unique
  mobile                 String?       
  isSelfLogin        Boolean?
  tempPassword        Boolean?      @default(true)
   
  password                    String       @db.VarChar(255)
  emailVerified               Boolean?      @default(false)
  phoneVerified               Boolean?      @default(false)
  createdAt                   DateTime     @default(now()) @db.Timestamp(0)
  updatedAt                   DateTime     @default(now()) @updatedAt @db.Timestamp(0)
  status                      Status       @default(Active)
  profileImage String  @default("uploads/default.jpg")
   
roleId Int?
roles  UserRole? @relation("user_roles", fields: [roleId], references: [id])

   resetOTPExpiresAt  DateTime?   
   resetOTP   String?

      verificationc1     Verification[]     @relation("verificationc1")
}


model Partner {
  id           Int      @id @default(autoincrement())
  tenantId     String
  tenantName   String?
  requestId    String?
  responseId   String?
  contactName   String?
  contactEmail   String?
  PreferredSlot   String?
  TimeZone   String?
  currentState String   @default("DISABLE") 
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Customer {
  id                       Int      @id @default(autoincrement())
  partnerTenantId           String
  partnerTenantName         String?
  acronisCustomerTenantId   String   @unique
  acronisCustomerTenantName String?
  status                    String
  settings                  Json?
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
}

model Credential {
  id               Int      @id @default(autoincrement())
  partnerTenantId   String   
  customerTenantId  String?
  clientId          String
  clientSecret      String
  datacenterUrl     String
  active        Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Settings {
  id                     Int     @id @default(autoincrement())
  customerLogInterval    Int     @default(5)
  customerDeviceInterval Int     @default(12)
  createdAt         DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model Device {
  id               Int      @id @default(autoincrement())
  partnerTenantId  String?
  customerTenantId String?
  agentId          String?
  hostname         String?
  hostId           String?
  online           Boolean?
  enabled          Boolean?
  osFamily         String?
  registrationDate DateTime?
  units            Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}


model AlertLog {
  id               Int      @id @default(autoincrement())
  alertId          String   // Acronis alert ID
  partnerTenantId  String
  customerName  String
  customerTenantId String
  rawJson          Json
  loggedAt         DateTime @default(now())
    createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Policy {
  id                Int       @id @default(autoincrement())
  policyId          String    // original policy.id from Acronis
  createdAtAcronis  String?
  updatedAtAcronis  String?
  type              String?
  name              String?
  origin            String?
  enabled           Boolean?

  // Mapping back to Credential owner
  partnerTenantId   String
  customerTenantId  String

  // Store resource + agent for clarity
  agentId           String?
  resourceId        String?

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}
